<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>「RISC-V」spike 工具链的调试与时钟中断学习 - TonyCrane&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="TonyCrane&#039;s Blog"><meta name="msapplication-TileImage" content="/tonycrane.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="TonyCrane&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="想探索一下在 OS 课上写一个指导来让同学们可以像系统一样选择 spike 来进行 RISC-V kernel 调试。当时系统三助教的时候用过，但是 spike 是学长改过的 riscv-isa-cosim（加了 CJ 也就是 difftest 的部分），这个目前已经有段时间没更新了，所以在尝试使用最新版本 OpenSBI（启用 PIE 编译）的时候无法加载 ELF（还不支持 PIE），于是就更换"><meta property="og:type" content="blog"><meta property="og:title" content="「RISC-V」spike 工具链的调试与时钟中断学习"><meta property="og:url" content="https://blog.tonycrane.cc/p/9188d8c1.html"><meta property="og:site_name" content="TonyCrane&#039;s Blog"><meta property="og:description" content="想探索一下在 OS 课上写一个指导来让同学们可以像系统一样选择 spike 来进行 RISC-V kernel 调试。当时系统三助教的时候用过，但是 spike 是学长改过的 riscv-isa-cosim（加了 CJ 也就是 difftest 的部分），这个目前已经有段时间没更新了，所以在尝试使用最新版本 OpenSBI（启用 PIE 编译）的时候无法加载 ELF（还不支持 PIE），于是就更换"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.tonycrane.cc/img/og_image.png"><meta property="article:published_time" content="2024-09-19T05:27:51.000Z"><meta property="article:modified_time" content="2024-09-19T08:12:22.620Z"><meta property="article:author" content="TonyCrane"><meta property="article:tag" content="笔记"><meta property="article:tag" content="RISC-V"><meta property="article:tag" content="spike"><meta property="article:tag" content="学习"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.tonycrane.cc/p/9188d8c1.html"},"headline":"「RISC-V」spike 工具链的调试与时钟中断学习","image":["https://blog.tonycrane.cc/img/og_image.png"],"datePublished":"2024-09-19T05:27:51.000Z","dateModified":"2024-09-19T08:12:22.620Z","author":{"@type":"Person","name":"TonyCrane"},"publisher":{"@type":"Organization","name":"TonyCrane's Blog","logo":{"@type":"ImageObject","url":"https://blog.tonycrane.cc/BlogLogo.png"}},"description":"想探索一下在 OS 课上写一个指导来让同学们可以像系统一样选择 spike 来进行 RISC-V kernel 调试。当时系统三助教的时候用过，但是 spike 是学长改过的 riscv-isa-cosim（加了 CJ 也就是 difftest 的部分），这个目前已经有段时间没更新了，所以在尝试使用最新版本 OpenSBI（启用 PIE 编译）的时候无法加载 ELF（还不支持 PIE），于是就更换"}</script><link rel="canonical" href="https://blog.tonycrane.cc/p/9188d8c1.html"><link rel="icon" href="/tonycrane.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro&amp;family=JetBrains+Mono:ital,wght@0,300;0,400;0,600;0,700;1,400;1,700"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?4fb5d144c1a2304049b314651f3033bc";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-GQ1YD8G8PG" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-GQ1YD8G8PG');</script><!--!--><!--!--><script src="https://gcore.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="TonyCrane's Blog" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/BlogLogo.png" alt="TonyCrane&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/friends">友链</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item colormode" id="colormode" title="颜色主题" href="javascript:;"><i class="fas fa-sun"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item" style="color: #3bab62;"><i class="fas fa-bell" style="margin-right: 0.3em;"></i>最新</span><span class="level-item"><time dateTime="2024-09-19T05:27:51.000Z" title="2024/9/19 13:27:51">2024-09-19</time>发表</span><span class="level-item"><time dateTime="2024-09-19T08:12:22.620Z" title="2024/9/19 16:12:22">2024-09-19</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/RISC-V/">RISC-V</a><span> / </span><a class="link-muted" href="/categories/RISC-V/%E7%AC%94%E8%AE%B0/">笔记</a></span><span class="level-item">29 分钟读完 (大约4306个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">「RISC-V」spike 工具链的调试与时钟中断学习</h1><div class="content"><p>想探索一下在 OS 课上写一个指导来让同学们可以像系统一样选择 <a target="_blank" rel="noopener" href="https://github.com/riscv-software-src/riscv-isa-sim/">spike</a> 来进行 RISC-V kernel 调试。当时系统三助教的时候用过，但是 spike 是学长改过的 <a target="_blank" rel="noopener" href="https://github.com/sycuricon/riscv-isa-cosim">riscv-isa-cosim</a>（加了 CJ 也就是 difftest 的部分），这个目前已经有段时间没更新了，所以在尝试使用最新版本 OpenSBI（启用 PIE 编译）的时候无法加载 ELF（还不支持 PIE），于是就更换成了最新的 spike，然后就有了以下的调试过程。</p>
<span id="more"></span>

<h2 id="关于工具链"><a href="#关于工具链" class="headerlink" title="关于工具链"></a>关于工具链</h2><p>Spike 这套东西的逻辑就是，spike 自身是一个专注于 RISC-V 规范的模拟器，而且也模拟了硬件机制，在调试时需要通过 JTAG 来调试，并且开了一个 remote bitbang 的端口用来收发指令。然后使用 <a target="_blank" rel="noopener" href="https://github.com/openocd-org/openocd/">OpenOCD</a> 来连接这个 rbb 端口进行指令的解析，再开一个端口来供 GDB 读取这些信息进行调试。</p>
<p>Spike 是从 repo 中安装的最新版：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/riscv-software-src/riscv-isa-sim</span><br><span class="line"><span class="built_in">cd</span> riscv-isa-sim</span><br><span class="line">sudo apt install device-tree-compiler libboost-regex-dev libboost-system-dev</span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">../configure</span><br><span class="line">make -j$(nproc)</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<p>OpenOCD 是直接 apt 安装的，OpenSBI 也是 repo 中的最新版：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/riscv-software-src/opensbi</span><br><span class="line"><span class="built_in">cd</span> opensbi</span><br><span class="line">mkdir build</span><br><span class="line">make O=build CROSS_COMPILE=riscv64-linux-gnu- PLATFORM=generic</span><br><span class="line"><span class="comment"># output: build/platform/generic/firmware/fw_jump.elf</span></span><br></pre></td></tr></table></figure>

<p>然后一些命令：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">spike_run: all</span></span><br><span class="line">	@echo Launch the spike ......</span><br><span class="line">	@spike --kernel=arch/riscv/boot/Image <span class="variable">$(SPIKE_CONFIG)</span>/fw_jump.elf</span><br><span class="line"></span><br><span class="line"><span class="section">spike_debug: all</span></span><br><span class="line">	@echo Launch the spike for debug ......</span><br><span class="line">	@spike -H --rbb-port=9824 --kernel=arch/riscv/boot/Image <span class="variable">$(SPIKE_CONFIG)</span>/fw_jump.elf</span><br><span class="line"></span><br><span class="line"><span class="section">spike_bridge:</span></span><br><span class="line">	@echo Launch the OpenOCD ......</span><br><span class="line">	@openocd -f <span class="variable">$(SPIKE_CONFIG)</span>/spike.cfg</span><br></pre></td></tr></table></figure>

<p>其中 OpenOCD 的配置文件 <code>spike.cfg</code> 如下（最开始的版本）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">adapter driver remote_bitbang</span><br><span class="line">remote_bitbang_host localhost</span><br><span class="line">remote_bitbang_port 9824</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> _CHIPNAME riscv</span><br><span class="line">jtag newtap <span class="variable">$_CHIPNAME</span> cpu -irlen 5 </span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> _TARGETNAME <span class="variable">$_CHIPNAME</span>.cpu</span><br><span class="line">target create <span class="variable">$_TARGETNAME</span> riscv -chain-position <span class="variable">$_TARGETNAME</span></span><br><span class="line"></span><br><span class="line">bindto 0.0.0.0</span><br><span class="line">gdb_report_data_abort <span class="built_in">enable</span></span><br><span class="line"></span><br><span class="line">init</span><br><span class="line">halt</span><br></pre></td></tr></table></figure>

<p><code>make spike_run</code> 就是直接运行 kernel，<code>make spike_debug</code> 开启调试模式，再另开一个终端跑 <code>make spike_bridge</code> 启动 OpenOCD 然后就可以用 GDB 连接了。</p>
<h2 id="GDB-调试时不断遇到-SIGINT"><a href="#GDB-调试时不断遇到-SIGINT" class="headerlink" title="GDB 调试时不断遇到 SIGINT"></a>GDB 调试时不断遇到 SIGINT</h2><p>刚开始的时候 spike_run 没问题，但是一旦调试起来，连接上后再 b _start，随后 c 的话就会在中间多次遇到 SIGINT 导致调试暂停，即使 <code>handle SIGINT nostop</code> 的话也会看到跑到 _start 之前一直在忽略 SIGINT 而且效率极低。</p>
<p>这个问题调的很痛苦，因为在同一 OpenOCD 和配置下，用同样 OpenSBI，使用最新 spike 和老的 cosim 的结果不一样（cosim 不会 SIGINT），所以问题就被锁定在 spike 身上了。</p>
<p>起初我认为是 spike 添加了 debug triggers 的问题，因为我是头一次在 OpenSBI 的输出中看到 sdtrig 指令集扩展，然后看到了 4 triggers，但是虽然有 <code>--trigger</code> 参数来指定数量，也不能使它小于 1。同时即使设定了 <code>--isa=RV64gc</code> 不带任何扩展，也会自动加上 sdtrig。当时几乎就认定是 trigger 的问题了，但是后来在 riscv/processor.cc 中发现了函数 <code>processor_t::take_trigger_action</code>，在这个开头把输出的 trigger 信息硬性要求输出到 stdout 中，发现并没有输出：</p>
<figure class="highlight cpp"><figcaption><span>(spike) riscv/processor.cc:543</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">processor_t::take_trigger_action</span><span class="params">(triggers::<span class="keyword">action_t</span> action, <span class="keyword">reg_t</span> breakpoint_tval, <span class="keyword">reg_t</span> epc, <span class="keyword">bool</span> virt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (debug) &#123;</span><br><span class="line">    std::stringstream s; <span class="comment">// first put everything in a string, later send it to output</span></span><br><span class="line">    s &lt;&lt; <span class="string">&quot;core &quot;</span> &lt;&lt; std::dec &lt;&lt; std::<span class="built_in">setfill</span>(<span class="string">&#x27; &#x27;</span>) &lt;&lt; std::<span class="built_in">setw</span>(<span class="number">3</span>) &lt;&lt; id</span><br><span class="line">      &lt;&lt; <span class="string">&quot;: trigger action &quot;</span> &lt;&lt; (<span class="keyword">int</span>)action &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">debug_output_log</span>(&amp;s);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>而且同样我在 <code>processor_t::take_trap</code> 开头把输出也强制打开了，也只能发现在 0x80000000 之后（屏蔽了这前面的部分，因为 0x1000 前会有 debug rom 一直在运行一直在 trap）只出现过一个 store access fault 的 trap。所以那就能排除掉 trigger 的问题了。</p>
<p>接着我从源码安装了 OpenOCD（v0.12+）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/openocd-org/openocd/</span><br><span class="line"><span class="built_in">cd</span> openocd</span><br><span class="line">sudo apt install libtool</span><br><span class="line">./bootstrap</span><br><span class="line">./configure --enable-remote-bitbang</span><br><span class="line">make</span><br><span class="line"><span class="comment"># output: src/openocd</span></span><br></pre></td></tr></table></figure>

<p>与本地的 v0.11 的相比，它运行时多了一些 error，而且恰巧在每次 SIGINT 的同时都能看到新增了一条 error：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Warn : Failed to read memory via program buffer.</span><br><span class="line">Error: Failed write (NOP) at 0x7; status=2</span><br><span class="line">Error: Failed write (NOP) at 0x6; status=2</span><br><span class="line">Warn : Failed to read memory via abstract access.</span><br><span class="line">Error: Target riscv.cpu: Failed to read memory (addr=0x0)</span><br><span class="line">Error:   progbuf=failed, sysbus=skipped (unsupported size), abstract=failed</span><br></pre></td></tr></table></figure>

<p>我又认为这是 OpenOCD+GDB 在调试时访问 0x0 处的非法内存导致的，经学长解答，0x0 开始的这部分是一个 debug module，在调试的时候是会用到的。在 riscv/sim.cc 的 <code>sim_t::sim_t</code> 函数中也看到了开头就有一句 <code>bus.add_device(DEBUG_START, &amp;debug_module);</code>，然后我又去翻了翻 debug module，它在一些指定的位置才放了内存，比如 0x800 开始放了 debug rom，0x374 这里放了 progbuf，而其他没放的地方访问的时候都会像这样出错。这部分逻辑在 riscv/debug_module.cc 的 <code>debug_module_t::load</code> 中：</p>
<figure class="highlight cpp"><figcaption><span>(spike) riscv/debug_module.cc:125</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">debug_module_t::load</span><span class="params">(<span class="keyword">reg_t</span> addr, <span class="keyword">size_t</span> len, <span class="keyword">uint8_t</span>* bytes)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  addr = DEBUG_START + addr;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (addr &gt;= DEBUG_ROM_ENTRY &amp;&amp;</span><br><span class="line">      (addr + len) &lt;= (DEBUG_ROM_ENTRY + debug_rom_raw_len)) &#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(bytes, debug_rom_raw + addr - DEBUG_ROM_ENTRY, len);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="built_in">D</span>(<span class="built_in">fprintf</span>(stderr, <span class="string">&quot;ERROR: invalid load from debug module: %zd bytes at 0x%016&quot;</span></span><br><span class="line">          PRIx64 <span class="string">&quot;\n&quot;</span>, len, addr));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>学长说 cosim 里面屏蔽了 0x0 这个地址，然后在这个地址的位置放了一个随机数设备来防止读取出问题，但我还是想找到问题所在，所以继续调了。</p>
<p>将末尾的 D() 去掉，然后 return true 就能让所有 0x0 - 0x1000 的访存合法，再跑一次发现 OpenOCD 那里确实没有报错了，然后每次都会从 0x0 开始请求一串内存，这里都会报 ERROR。但即使 OpenOCD 没了报错，GDB 还是会像原先一样隔一阵遇到一个 SIGINT，所以那这个 SIGINT 也不是由于 OpenOCD 读 debug 信息错误导致的。</p>
<p>接下来就翻了翻 OpenOCD 的文档，发现了在 GDB 相关的 20.2 节给出了一个简单的 GDB 调试案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ arm-none-eabi-gdb example.elf</span><br><span class="line">(gdb) target extended-remote localhost:3333</span><br><span class="line">Remote debugging using localhost:3333</span><br><span class="line">...</span><br><span class="line">(gdb) monitor reset halt</span><br><span class="line">...</span><br><span class="line">(gdb) load</span><br><span class="line">Loading section .vectors, size 0x100 lma 0x20000000</span><br><span class="line">Loading section .text, size 0x5a0 lma 0x20000100</span><br><span class="line">Loading section .data, size 0x18 lma 0x200006a0</span><br><span class="line">Start address 0x2000061c, load size 1720</span><br><span class="line">Transfer rate: 22 KB/sec, 573 bytes/write.</span><br><span class="line">(gdb) continue</span><br><span class="line">Continuing.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>这里多了一句 <code>monitor reset halt</code> 不知道是干什么，然后随手一试，加上这一句之后 SIGINT 就消失了，可以正常调试了。或者在 spike.cfg 配置的最后把 <code>halt</code> 改成 <code>reset halt</code> 也可以，因为 GDB 的 <code>monitor</code> 就相当于发指令给 OpenOCD。又搜了一些也没找到这样做的理由，听到的说法都是刷新程序，让它好接收后面的断点和调试。所以调了好久最后原因是 OpenOCD 的配置问题，但为什么 cosim 的老 spike 没遇到问题还是没解决，但已经无所谓了感觉。</p>
<h2 id="Semihosting-相关"><a href="#Semihosting-相关" class="headerlink" title="Semihosting 相关"></a>Semihosting 相关</h2><p>接下来没有 SIGINT 就可以一直跑起来的，但是并没有断在 _start 的断点的位置，而是在 OpenSBI 中的 ebreak，这个 ebreak 是在 <code>_semihost_test_vector_next</code> 标号里的，这个是由 OpenSBI 的 lib/utils/serial/semihosting.c 的 semihosting_enabled 函数引入的。学长说是因为 spike 并没有支持 semihosting 机制，所以在之前使用的 OpenSBI 中手动在 semihosting_enabled 和 semihosting_trap 函数的开头直接 return 了 0 来 patch 掉。</p>
<p>搜了一下 semihosting 相关，这是一个由 arm 引入的调试方法。因为硬件上通过串口输出还要经过设备时序等一系列，会加重调试负担，所以 semihosting 机制通过将输出等一系列功能交给调试主机来做，这样就不需要硬件串口支持了。只需要在比如 print 输出的时候调用一下 SVC HLT BKPT 等可以让调试器接手的指令，然后调试器会安装协议读取要进行的操作等，由调试器来进行输出。</p>
<p>在 RISC-V 上，这样陷入调试器的指令是 ebreak，但是也只有 ebreak，无法区分普通 ebreak 和 semihosting 用的 ebreak。所以 RISC-V 规定，semihosting 的 ebreak 前后会跟两条特殊的 nop 指令，形成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">slli x0, x0, 0x1f</span><br><span class="line">ebreak</span><br><span class="line">srai x0, x0, 7</span><br></pre></td></tr></table></figure>

<p>调试器在遇到 ebreak 之后可以检查前后两条指令，如果是这样的形式，那么就是 semihosting 的 ebreak，否则就是普通的 ebreak。这个是在 RISC-V 的 <a target="_blank" rel="noopener" href="https://github.com/riscv-non-isa/riscv-semihosting">riscv-non-isa/riscv-semihosting</a> 中规定的。</p>
<p>看了 spike 的源码，关于 ebreak 指令的处理确实没有检查前后两条指令的操作。但转念一想，spike 作为一个指令模拟器，它就是一个待调试的硬件设备，而真正处理 semihosting 的应该是调试器，而在这套工具链里调试器是 OpenOCD，所以实际的工作应该在 OpenOCD 层面，在收到 ebreak 之后额外检查两条指令。</p>
<p>经过搜索，OpenOCD 还真有这么一条指令 <code>arm semihosting enable</code>，也就是 GDB 里的 <code>monitor arm semihosting enable</code>。跑了这条指令之后 GDB 就不会再卡在 semihosting 的 ebreak 了，因为这部分已经被 OpenOCD 解析成了 semihosting 请求来特殊处理了，而且 OpenSBI 输出的 platform console device 也从 uart8250 变成了 semihosting。也因此，输出等操作就由 OpenOCD 来完成了，而非 spike 的串口。所以这时候的内核输出在运行着 <code>make spike_bridge</code> 的终端里，而且这套效率并比不上串口，所以效率很低，以至于效果上是逐个字进行输出。</p>
<p>所以为了调试效率，还是不启用 semihosting 为好，但也不用直接 patch 掉相关逻辑，OpenSBI 提供了 kconfig 来进行配置，可以直接：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make PLATFORM=generic menuconfig</span><br></pre></td></tr></table></figure>

<p>然后将 Utils and Drivers Support &gt; Serial Device Support &gt; Semihosting support 关掉再 make 就好了。</p>
<h2 id="时钟中断相关"><a href="#时钟中断相关" class="headerlink" title="时钟中断相关"></a>时钟中断相关</h2><p>最后一个问题是 spike 运行的 kernel 的时钟中断周期和 busy loop 长度都要少一个 0 才能达到和 qemu 一样的效果，也就是实际上的时钟频率是 1_000_000 Hz，不过 spike 运行的 OpenSBI 输出的 platform timer device 还是都是一样的 aclint-mtimer @ 10000000Hz。</p>
<p>找了 OpenSBI 的源码，对于 generic platform，timer 的频率是从设备树中读取的。generic 使用了 fdt_timer_mtimer，其中的 cold init 调用了 OpenSBI 的 lib/utils/timer/fdt_timer_mtimer.c 的 <code>timer_mtimer_cold_init</code> 函数：</p>
<figure class="highlight c"><figcaption><span>(opensbi) lib/utils/timer/fdt_timer_mtimer.c:33</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">timer_mtimer_cold_init</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *fdt, <span class="keyword">int</span> nodeoff,</span></span></span><br><span class="line"><span class="params"><span class="function">				  <span class="keyword">const</span> struct fdt_match *match)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">	rc = fdt_parse_timebase_frequency(fdt, &amp;mt-&gt;mtime_freq);</span><br><span class="line">	<span class="keyword">if</span> (rc) &#123;</span><br><span class="line">		sbi_free(mtn);</span><br><span class="line">		<span class="keyword">return</span> rc;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>这里 <code>fdt_parse_timebase_frequency</code> 就是在读取设备树中的 <code>timebase-frequency</code> 属性，而这个属性在 spike 导出时就是 10_000_000：</p>
<figure class="highlight cpp"><figcaption><span>(spike) riscv/sim.cc:145</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dts = <span class="built_in">make_dts</span>(INSNS_PER_RTC_TICK, CPU_HZ, cfg, mems, device_nodes);</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><figcaption><span>(spike) riscv/dts.cc:59</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;    timebase-frequency = &lt;&quot;</span> &lt;&lt; (cpu_hz/insns_per_rtc_tick) &lt;&lt; <span class="string">&quot;&gt;;\n&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>这里 CPU_HZ 是 1_000_000_000，INSNS_PER_RTC_TICK 是 100，所以 freq 是 10_000_000 没错。</p>
<p>但为什么 spike 跑起来实际比这个要慢得多呢，按理说 10_000_000Hz 的时钟频率，设定 10_000_000 的时钟中断间隔那出现的就是 1s 一个，为什么会 10s 一个。原因在于 spike 对于 mtime 的处理：</p>
<figure class="highlight cpp"><figcaption><span>(spike) riscv/clint.cc:100</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clint_t::tick</span><span class="params">(<span class="keyword">reg_t</span> rtc_ticks)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (real_time) &#123;</span><br><span class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">now</span>;</span></span><br><span class="line">   <span class="keyword">uint64_t</span> diff_usecs;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">gettimeofday</span>(&amp;now, <span class="literal">NULL</span>);</span><br><span class="line">   diff_usecs = ((now.tv_sec - real_time_ref_secs) * <span class="number">1000000</span>) + (now.tv_usec - real_time_ref_usecs);</span><br><span class="line">   mtime = diff_usecs * freq_hz / <span class="number">1000000</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    mtime += rtc_ticks;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [hart_id, hart] : sim-&gt;<span class="built_in">get_harts</span>()) &#123;</span><br><span class="line">    hart-&gt;state.time-&gt;<span class="built_in">sync</span>(mtime);</span><br><span class="line">    hart-&gt;state.mip-&gt;<span class="built_in">backdoor_write_with_mask</span>(MIP_MTIP, mtime &gt;= mtimecmp[hart_id] ? MIP_MTIP : <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>clint 是 Core Local Interruptor，局部中断器，负责产生软件中断和时钟中断。这里也看得出，在 <code>mtime &gt;= mtimecmp[hard_id]</code> 的时候设置 mip 的 mtip 位，即告诉 core 又一个时钟中断在等待处理。</p>
<p>而 mtime 更新的逻辑在前面，如果有 real_time 的情况下，mtime 按照实际时间更新，假设我们经过了 1s 的时间，那 diff_usecs 就是 1_000_000，所以 mtime = freq_hz，也就是 10_000_000，这样 1s 之后 mtime 就多了 10_000_000，如果 mtimecmp 设置的间隔也是这个，那就是 1s 一个中断。实际跑起来，如果加上 <code>--real-time-clint</code> 的话，时钟中断确实就 1s 出现一个了（间隔 10_000_000）。</p>
<p>那如果不加 real_time 呢，也就是说为什么之前会出现 10s 一个中断的情况。我们再次假设 mtimecmp 的间隔是 10_000_000，看一下多久会触发，也就是 mtime 什么时候能多加 10_000_000 个 rtc_ticks。因为 INSN_PER_RTC_TICK 是 100，所以跑 100 条指令多一个 rtc_tick，那触发一次时钟中断就要跑 1_000_000_000 条指令，也就是说只和跑了多少条指令有关，和实际时间无关，所以体感 10s 一个中断实际上是纯粹的 spike 跑的慢。</p>
<p>所以为了 qemu 和 spike 一样的表现，只需要在 spike 运行的时候加上 <code>--real-time-clint</code> 就好了，以及如果有 busy loop 输出的话还需要按 10 倍的规模调整一下循环次数。</p>
<h3 id="关于-memory-mapping-与-stimecmp"><a href="#关于-memory-mapping-与-stimecmp" class="headerlink" title="关于 memory-mapping 与 stimecmp"></a>关于 memory-mapping 与 stimecmp</h3><p>调试的时候有的时候想要找 mtime 和 mtimecmp 的值到底是多少，但是 GDB 并不能读取这两个寄存器，因为他们两个都是 memory mapping 的，也就是说他们的实际位置在内存上而非寄存器中。所以我们可以通过读取内存来获取这两个值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p/x &#123;unsigned long long&#125;0x2004000 # mtimecmp</span><br><span class="line">p/x &#123;unsigned long long&#125;0x200bff8 # mtime</span><br></pre></td></tr></table></figure>

<p>Spike 和 qemu 都是同样的地址（spike 相关代码同样可以在 riscv/clint.cc 中找到，也就是 load 和 store 两个函数）。</p>
<p>但是有些情况下即使设置了 mtimecmp 也不会发现 0x2004000 地址上有变化（比如较新的 qemu 跑最新的 OpenSBI）。我们可以通过 sbi 来调查这个问题，时钟中断的设置是通过调用 sbi_set_timer 完成的，通过翻 OpenSBI 源码可以找到这个 set_timer 的实际处理函数在 lib/sbi/sbi_timer.c 里：</p>
<figure class="highlight c"><figcaption><span>(opensbi) lib/sbi/sbi_timer.c:132</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sbi_timer_event_start</span><span class="params">(u64 next_event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	sbi_pmu_ctr_incr_fw(SBI_PMU_FW_SET_TIMER);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Update the stimecmp directly if available. This allows</span></span><br><span class="line"><span class="comment">	 * the older software to leverage sstc extension on newer hardware.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (sbi_hart_has_extension(sbi_scratch_thishart_ptr(), SBI_HART_EXT_SSTC)) &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> __riscv_xlen == 32</span></span><br><span class="line">		csr_write(CSR_STIMECMP, next_event &amp; <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">		csr_write(CSR_STIMECMPH, next_event &gt;&gt; <span class="number">32</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">		csr_write(CSR_STIMECMP, next_event);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (timer_dev &amp;&amp; timer_dev-&gt;timer_event_start) &#123;</span><br><span class="line">		timer_dev-&gt;timer_event_start(next_event);</span><br><span class="line">		csr_clear(CSR_MIP, MIP_STIP);</span><br><span class="line">	&#125;</span><br><span class="line">	csr_set(CSR_MIE, MIP_MTIP);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这里有一个 if 逻辑，如果 sbi hart 有 sstc 扩展，则写入 stimecmp csr 寄存器结束，否则调用 timer_dev 的 timer_event_start，而 qemu 和 spike 都在使用的 aclint_mtimer 设备的 timer_event_start 就是在读取 mtimecmp 的地址，所以这部分逻辑是设置 0x2004000 的值的。那么如果 0x2004000 一直是 -1 的话，就说明已经走了 sstc 扩展的 stimecmp 寄存器了。</p>
<p>Sstc 扩展是为了解决每次设置时钟中断都需要进入 sbi 陷入 M 模式设置 mtimecmp 的值导致效率下降的，这个扩展引入了 stimecmp csr 寄存器，同时规定只要 mtime &gt;= stimecmp 直接触发 S 模式时钟中断。这样就避免了从 memory mapping 设置 mtimecmp 再触发 M 态时钟中断后再通过 mideleg 转发到 S 模式的过程，提高了效率。是否启用了 sstc 可以看 OpenSBI 输出的 boot hart isa extensions，如果里面有 sstc 就说明启用了。</p>
<p>而 spike 默认是不开启 sstc 的，但是它也支持，在上面 clint.cc 的 114 行可以看到一个 <code>hart-&gt;state.time-&gt;sync(mtime)</code>，这个函数的内容如下：</p>
<figure class="highlight cpp"><figcaption><span>(spike) riscv/csrs.cc:1140</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">time_counter_csr_t::sync</span><span class="params">(<span class="keyword">const</span> <span class="keyword">reg_t</span> val)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">  shadow_val = val;</span><br><span class="line">  <span class="keyword">if</span> (proc-&gt;<span class="built_in">extension_enabled</span>(EXT_SSTC)) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">reg_t</span> mip_val = (shadow_val &gt;= state-&gt;stimecmp-&gt;<span class="built_in">read</span>() ? MIP_STIP : <span class="number">0</span>) |</span><br><span class="line">      (shadow_val + state-&gt;htimedelta-&gt;<span class="built_in">read</span>() &gt;= state-&gt;vstimecmp-&gt;<span class="built_in">read</span>() ? MIP_VSTIP : <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">reg_t</span> mask = ((state-&gt;menvcfg-&gt;<span class="built_in">read</span>() &amp; MENVCFG_STCE) ? MIP_STIP : <span class="number">0</span>) | ((state-&gt;henvcfg-&gt;<span class="built_in">read</span>() &amp; HENVCFG_STCE) ? MIP_VSTIP : <span class="number">0</span>);</span><br><span class="line">    state-&gt;mip-&gt;<span class="built_in">backdoor_write_with_mask</span>(mask, mip_val);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以这个 sync 实际上就是在启用 sstc 的时候检测是否根据 stimecmp 触发时钟中断。spike 上启用 sstc 需要自己设定 isa，即加一个 <code>--isa=RV64gc_zicntr_sstc</code>，然后在 GDB 调试的时候 <code>i r stimecmp</code> 就能查看到 stimecmp 的值了（qemu 甚至不让看 stimecmp）。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://openocd.org/doc/html/">https://openocd.org/doc/html/</a></li>
<li><a target="_blank" rel="noopener" href="https://tinylab.org/riscv-semihosting/">https://tinylab.org/riscv-semihosting/</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/luolaihua2018/article/details/127344891">https://blog.csdn.net/luolaihua2018/article/details/127344891</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/506062424">https://zhuanlan.zhihu.com/p/506062424</a></li>
</ul>
<p>本文中出现源码的版本：</p>
<ul>
<li>opensbi: c4940a9517486413cd676fc8032bb55f9d4e2778</li>
<li>riscv-isa-sim: 0cc5ecce053c6dfa44e4a865d2838fc8d7d771dc</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>「RISC-V」spike 工具链的调试与时钟中断学习</p><p><a href="https://blog.tonycrane.cc/p/9188d8c1.html">https://blog.tonycrane.cc/p/9188d8c1.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>TonyCrane</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2024-09-19</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2024-09-19</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="link-muted mr-2" rel="tag" href="/tags/RISC-V/">RISC-V</a><a class="link-muted mr-2" rel="tag" href="/tags/spike/">spike</a><a class="link-muted mr-2" rel="tag" href="/tags/%E5%AD%A6%E4%B9%A0/">学习</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/p/dc8d460.html"><span class="level-item">「杂谈」由 PA 实验引发的一些思考</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><script src="https://giscus.app/client.js" data-repo="TonyCrane/TonyCrane.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxNzQ3Nzg0MzY=" data-category="General" data-category-id="DIC_kwDOCmroRM4CT8Di" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="zh-CN" crossorigin="anonymous" async></script><script>const t = localStorage.getItem("theme")
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
if (t === null) {
    if (isDarkMode) {
        var giscus = document.querySelector("script[src*=giscus]")
        giscus.setAttribute("data-theme", "https://gcore.jsdelivr.net/gh/TonyCrane/note/docs/css/giscus.css")
    } else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        if (isNight) {
            var giscus = document.querySelector("script[src*=giscus]")
            giscus.setAttribute("data-theme", "https://gcore.jsdelivr.net/gh/TonyCrane/note/docs/css/giscus.css")
        }
    }
} else if (JSON.parse(t).value === "dark") {
    var giscus = document.querySelector("script[src*=giscus]")
    giscus.setAttribute("data-theme", "https://gcore.jsdelivr.net/gh/TonyCrane/note/docs/css/giscus.css")
}</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/tonycrane.png" alt="鹤翔万里"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">鹤翔万里</p><p class="is-size-6 is-block">TonyCrane</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Jilin -&gt; Hangzhou, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">107</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">16</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">49</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://space.bilibili.com/171431343" target="_blank" rel="noopener">BiliBili主页</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/TonyCrane"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Notebook" href="https://note.tonycrane.cc/"><i class="fas fa-book"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="QQ" href="https://qm.qq.com/cgi-bin/qm/qr?k=IrHKn7S1NdpfCsCfxlIPe9_t0wuRAS3s&amp;noverify=0"><i class="fab fa-qq"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:tonycrane@foxmail.com"><i class="fas fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Telegram" href="https://t.me/TonyCraneSky"><i class="fab fa-telegram"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-19T05:27:51.000Z">2024-09-19</time></p><p class="title"><a href="/p/9188d8c1.html">「RISC-V」spike 工具链的调试与时钟中断学习</a></p><p class="categories"><a href="/categories/RISC-V/">RISC-V</a> / <a href="/categories/RISC-V/%E7%AC%94%E8%AE%B0/">笔记</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-02-01T16:37:23.000Z">2023-02-02</time></p><p class="title"><a href="/p/dc8d460.html">「杂谈」由 PA 实验引发的一些思考</a></p><p class="categories"><a href="/categories/%E6%9D%82%E8%B0%88/">杂谈</a> / <a href="/categories/%E6%9D%82%E8%B0%88/%E5%AD%A6%E4%B9%A0/">学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-26T21:18:19.000Z">2022-10-27</time></p><p class="title"><a href="/p/169d9f3d.html">「Hackergame 2022」#3 Writup 囤囤囤 1</a></p><p class="categories"><a href="/categories/Writeup/">Writeup</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-26T21:18:13.000Z">2022-10-27</time></p><p class="title"><a href="/p/4fd94ed.html">「Hackergame 2022」#2 Writup 囤囤囤 0</a></p><p class="categories"><a href="/categories/Writeup/">Writeup</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-26T21:13:38.000Z">2022-10-27</time></p><p class="title"><a href="/p/c8afb596.html">「Hackergame 2022」#1 Writup 开局杀题</a></p><p class="categories"><a href="/categories/Writeup/">Writeup</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/09/"><span class="level-start"><span class="level-item">九月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">二月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">一月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">三月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">一月 2019</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AtCoder/"><span class="tag">AtCoder</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CSP-S/"><span class="tag">CSP-S</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cpp/"><span class="tag">Cpp</span><span class="tag">67</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Haskell/"><span class="tag">Haskell</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Luogu/"><span class="tag">Luogu</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NOIp/"><span class="tag">NOIp</span><span class="tag">33</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RISC-V/"><span class="tag">RISC-V</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rust/"><span class="tag">Rust</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SPOJ/"><span class="tag">SPOJ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Writeup/"><span class="tag">Writeup</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bfs/"><span class="tag">bfs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/blog/"><span class="tag">blog</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bug/"><span class="tag">bug</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dsu-on-tree/"><span class="tag">dsu on tree</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/manim/"><span class="tag">manim</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">markdown</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mkdocs/"><span class="tag">mkdocs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spike/"><span class="tag">spike</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9B%BE%E8%AE%BA/"><span class="tag">图论</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AD%A6%E4%B9%A0/"><span class="tag">学习</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A6%E5%81%8F%E6%A0%91/"><span class="tag">左偏树</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F/"><span class="tag">差分约束</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/"><span class="tag">并查集</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="tag">数据结构</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E8%AE%BA/"><span class="tag">数论</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%80%E5%A4%A7%E6%B5%81/"><span class="tag">最大流</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/"><span class="tag">最短路</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82%E8%B0%88/"><span class="tag">杂谈</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/"><span class="tag">树状数组</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B8%B8%E8%AE%B0/"><span class="tag">游记</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9/"><span class="tag">状态压缩</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%9F%E6%B4%BB/"><span class="tag">生活</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AC%94%E8%AE%B0/"><span class="tag">笔记</span><span class="tag">30</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/"><span class="tag">算法</span><span class="tag">32</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/"><span class="tag">线段树</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/"><span class="tag">网络流</span><span class="tag">22</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%8C%83%E7%95%B4%E8%AE%BA/"><span class="tag">范畴论</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%8E%AB%E9%98%9F/"><span class="tag">莫队</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/"><span class="tag">计算几何</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%B4%B9%E7%94%A8%E6%B5%81/"><span class="tag">费用流</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9A%8F%E7%AC%94/"><span class="tag">随笔</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%A2%98%E8%A7%A3/"><span class="tag">题解</span><span class="tag">36</span></a></div></div></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/C-%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">C++算法</span></span><span class="level-end"><span class="level-item tag">32</span></span></a><ul><li><a class="level is-mobile" href="/categories/C-%E7%AE%97%E6%B3%95/%E7%AC%94%E8%AE%B0/"><span class="level-start"><span class="level-item">笔记</span></span><span class="level-end"><span class="level-item tag">11</span></span></a><ul><li><a class="level is-mobile" href="/categories/C-%E7%AE%97%E6%B3%95/%E7%AC%94%E8%AE%B0/%E5%9B%BE%E8%AE%BA/"><span class="level-start"><span class="level-item">图论</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/C-%E7%AE%97%E6%B3%95/%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="level-start"><span class="level-item">数据结构</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/RISC-V/"><span class="level-start"><span class="level-item">RISC-V</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/RISC-V/%E7%AC%94%E8%AE%B0/"><span class="level-start"><span class="level-item">笔记</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Writeup/"><span class="level-start"><span class="level-item">Writeup</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/manim/"><span class="level-start"><span class="level-item">manim</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/manim/%E7%AC%94%E8%AE%B0/"><span class="level-start"><span class="level-item">笔记</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E6%9D%82%E8%B0%88/"><span class="level-start"><span class="level-item">杂谈</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E6%9D%82%E8%B0%88/%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">学习</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E6%B8%B8%E8%AE%B0/"><span class="level-start"><span class="level-item">游记</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%94%9F%E6%B4%BB/"><span class="level-start"><span class="level-item">生活</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E7%94%9F%E6%B4%BB/%E6%9D%82%E8%B0%88/"><span class="level-start"><span class="level-item">杂谈</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E9%A2%98%E8%A7%A3/"><span class="level-start"><span class="level-item">题解</span></span><span class="level-end"><span class="level-item tag">33</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E9%A2%98%E8%A7%A3/%E7%BD%91%E7%BB%9C%E6%B5%8124%E9%A2%98/"><span class="level-start"><span class="level-item">网络流24题</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#关于工具链"><span class="level-left"><span class="level-item">1</span><span class="level-item">关于工具链</span></span></a></li><li><a class="level is-mobile" href="#GDB-调试时不断遇到-SIGINT"><span class="level-left"><span class="level-item">2</span><span class="level-item">GDB 调试时不断遇到 SIGINT</span></span></a></li><li><a class="level is-mobile" href="#Semihosting-相关"><span class="level-left"><span class="level-item">3</span><span class="level-item">Semihosting 相关</span></span></a></li><li><a class="level is-mobile" href="#时钟中断相关"><span class="level-left"><span class="level-item">4</span><span class="level-item">时钟中断相关</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#关于-memory-mapping-与-stimecmp"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">关于 memory-mapping 与 stimecmp</span></span></a></li></ul></li><li><a class="level is-mobile" href="#参考"><span class="level-left"><span class="level-item">5</span><span class="level-item">参考</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/BlogLogo.png" alt="TonyCrane&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 TonyCrane</span><br>Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> with theme <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a> modified by <a href="https://github.com/TonyCrane" target="_blank" rel="noopener">TonyCrane</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></footer><script src="https://gcore.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://gcore.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://gcore.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://gcore.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://gcore.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://gcore.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://gcore.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/darkmode.js"></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>